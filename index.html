<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <!-- CSS -->
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
    <!-- CSS Padrão do Leaflet [Necessário] | O leaflet permite utilização de funções no mapa -->
    <link href='https://api.tiles.mapbox.com/mapbox.js/v2.2.4/mapbox.css' rel='stylesheet' />
    <!-- CSS Padrão do Mapbox [Necessário] | O mapbox permite utilização de funções no mapa e define o estilo dele -->
    <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-label/v0.2.1/leaflet.label.css' rel='stylesheet' />
    <!-- CSS Padrão do Leaflet Label | Permite a criação de labels por hover em cima dos edifícios -->
    <link href='css/style.css' rel='stylesheet' />
    <!-- Nossa folha de estilos personalizada -->
    <link href='css/jquery-ui.min.css' rel='stylesheet' />
    <!-- CSS Padrão do jquery-ui | Utilizamos o jquery-ui para a função de autocomplete -->
    <!-- JS -->
    <script src="js/leaflet.js"></script>
    <!-- JS Padrão do Leaflet [Necessário] -->
    <script src="js/OSMBuildings-Leaflet.js"></script>
    <!-- JS Padrão do OSMBuildings | O OSMBuildings permite a criação de objetos 2.5D com o GeoJSON -->
    <script src='https://api.tiles.mapbox.com/mapbox.js/v2.2.4/mapbox.js'></script>
    <!-- JS Padrão do Mapbox [Necessário] -->
    <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-label/v0.2.1/leaflet.label.js'></script>
    <!-- JS Padrão do Leaflet Label -->
    <script src='js/jquery-2.2.1.min.js'></script>
    <!-- JQuery -->
    <script src='js/popups.js'></script>
    <!-- JS contendo o conteúdo de todos os popups dos edifícios -->
    <script src='js/data.js'></script>
    <!-- JS contendo os edifícios em uma única collection de GeoJSON para utilizar o OSMBuildings -->
    <script src='js/data2.js'></script>
    <!-- JS contendo os edifícios em variáveis para criação deles com GeoJSON e implementação do popup. -->
    <script src='js/navigation.js'></script>
    <!-- JS contendo as informações relacionadas à caixa de pesquisa -->
    <script src='js/jquery-ui.min.js'></script>
    <!-- JS Padrão do JQuery UI -->
</head>

<body>
    <div class="wrapper">
        <div id="header">
            <input id="searchBox" placeholder="Buscar por setor, bloco ou sala" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Buscar por setor, bloco ou sala'"><button id="searchMap" type="button" alt="Buscar"><img src="images/search.png"></button>

            <button id="localMap" type="button" alt="Meu local"><img src="images/local.png"></button>
            <ul id="outros">
                <a href="#"><li id="collab">Colaboradores</li></a>
                <a href="#"><li id="helper">Gostaria de colaborar?</li></a>
            </div>

        </div>
        <div id="content">
            <div id="map" style="overflow: hidden; position: absolute; width: 100%; left: 0; height: 100%;"></div>
        </div>
    </div>
    <script>
        //Estilo utilizado para tornar a layer dos edifícios invisível/visível (a layer de edifícios é necessária para que os edifícios sejam clicáveis - isso é referente ao data.js)
        var hidden = {
            "color": "#ffffff",
            "weight": 5,
            "opacity": 0,
            "fillOpacity": 0,
            "fillColor": "#ffffff"
        };
        //Coordenadas salvas em uma variável para limitar a área de visualização do mapa
        var southWest = L.latLng(-7.145, -34.855),
            northEast = L.latLng(-7.129, -34.84),
            bounds = L.latLngBounds(southWest, northEast);
        //Inicialização do mapa e limitando a área de visualização do mapa com a variável bounds
        L.mapbox.accessToken = 'pk.eyJ1IjoiMTJoYXZlbnNsYXYiLCJhIjoiY2lrcXUzajI4MDA5cHZlbTNoOGs4cHk1byJ9.YKesU01czArkvWBSXzj1iA';
        var map = L.mapbox.map('map', 'mapbox.streets', {
                maxBounds: bounds,
                maxZoom: 19,
                minZoom: 17
            })
            .setView([-7.1383, -34.855972], 15);
        // Código para utilização das tiles do Mapbox
        // (new L.TileLayer('http://otile4.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png', { MAPBOX
            (new L.TileLayer('http://otile1.mqcdn.com/tiles/1.0.0/osm', {
            minZoom: 15
        }, {})).addTo(map);
        //Condição para aplicação do OSMBuildings apenas se o tamanho da tela for maior que o especificado
        // COMENTADO - Condição para omitir OSMBuildings em mobile if ($(window).width() > 850) {         } else {}
            //Adicionar os edifícios 2.5D aos polígonos especificados no data.js
            new OSMBuildings(map).set(data);
        //Isso é um teste do PANNELLUM - Virtual Tour 360º
        var marker = L.marker([-7.136318, -34.845205]).addTo(map);
        marker.bindPopup('<iframe width="700" height="400" allowfullscreen style="border-style:none;" src="http://localhost/pannellum/pannellum.htm?panorama=http://localhost/pannellum/pano2.jpg&amp;title=Montanha&amp;preview=http://localhost/pannellum/panopreview.jpg"></iframe>');
        //Estilo para autopadding dos popups
        var autopad = {
                autoPanPaddingBottomRight: [50, 50],
                autoPanPaddingTopLeft: [50, 120]
            }
            //Adicionar os marcadores transparentes. Eles servem para a função de pesquisa.
        var transIcon = L.Icon.extend({});
        var transmarker = new transIcon({
            iconUrl: 'images/trans.png'
        });
        //Adicionar os edifícios salvos em variáveis no data2.js através do GeoJSON. Cada edifício tem uma variável diferente e, graças a isso, abrirá um popup diferente que está definido no popups.js

        new L.geoJson(PredioCCHLA, {
            style: hidden
        }).bindLabel('Prédio - CCHLA').addTo(map).bindPopup(PredioCCHLA_pop, (autopad));
        new L.geoJson(CCSABloco1, {
            style: hidden
        }).bindLabel('CCSA - Bloco 1').addTo(map).bindPopup(CCSABloco1_pop, (autopad));
        new L.geoJson(CCSABloco2, {
            style: hidden
        }).bindLabel('CCSA - Bloco 2').addTo(map).bindPopup(CCSABloco2_pop, (autopad));
        new L.geoJson(DEMID, {
            style: hidden
        }).bindLabel('DEMID - Departamento de Mídias Digitais').addTo(map).bindPopup(DEMID_pop, (autopad));
        new L.geoJson(CEBloco1, {
            style: hidden
        }).bindLabel('CE - Bloco 1').addTo(map).bindPopup(CEBloco1_pop, (autopad));
        new L.geoJson(CEBloco2, {
            style: hidden
        }).bindLabel('CE - Bloco 2').addTo(map).bindPopup(CEBloco2_pop, (autopad));
        new L.geoJson(CEBloco3, {
            style: hidden
        }).bindLabel('CE - Bloco 3').addTo(map).bindPopup(CEBloco3_pop, (autopad));

    </script>
</body>
</html>